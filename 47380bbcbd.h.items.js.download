'https://github.com/swmff/rainbeam';function asyncGeneratorStep(e,t,n,r,s,o,a){try{var c=e[o](a),u=c.value}catch(e){n(e);return}c.done?t(u):Promise.resolve(u).then(r,s)}function _async_to_generator(e){return function(){var t=this,n=arguments;return new Promise(function(r,s){var o=e.apply(t,n);function a(e){asyncGeneratorStep(o,r,s,a,c,"next",e)}function c(e){asyncGeneratorStep(o,r,s,a,c,"throw",e)}a(void 0)})}}function _ts_generator(e,t){var n,r,s,o,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(s=(s=a.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}!function(){var e,t,n,r,s,o,a=reg_ns("items",["app"]);a.define("create",function(e,t,n,r,s,o){e.$;var a=e.app;return new Promise(function(e,c){fetch("/api/v0/auth/items",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,description:n,content:r,cost:s,type:o})}).then(function(e){return e.json()}).then(function(t){a.toast(t.success?"success":"error",t.success?"Item created!":t.message),!0===t.success?e(t.payload):c()})})}),a.define("content_input",(e=_async_to_generator(function(e,t){var n,r,s,o,a,c,u,i,l,f,p,h,y;return _ts_generator(this,function(d){switch(d.label){case 0:if(e._,n=e.app,r="","UserTheme"!==t)return[3,6];return[4,n.confirm("Are you sure you would like to create an item using your current profile theme?\n\nYou can press no to input CSS directly instead.")];case 1:if(d.sent())return[3,3];return[4,n.prompt_long("Enter CSS manually:")];case 2:if(!(s=d.sent()))return[2];return[2,s];case 3:case 13:return[4,fetch("/api/v0/auth/me")];case 4:case 14:return[4,d.sent().json()];case 5:if(!(o=d.sent()).success)return[2,alert(o.message||"Failed to fetch self.")];a=":root,*{",c="",u=!0,i=!1,l=void 0;try{for(f=Object.entries(o.payload.metadata.kv)[Symbol.iterator]();!(u=(p=f.next()).done);u=!0)(h=p.value)[1]&&(h[0].startsWith("sparkler:color_")?a+="/* ".concat(h[0]," */\n--").concat(h[0].replace("sparkler:","").replaceAll("_","-"),":").concat(h[1]," !important;\n"):"sparkler:custom_css"===h[0]?c=h[1]:console.log("skip ".concat(h[0])))}catch(e){i=!0,l=e}finally{try{u||null==f.return||f.return()}finally{if(i)throw l}}return r="".concat(a,"}\n/* sparkler:custom_css */\n").concat(c),console.log("content compiled"),[3,17];case 6:if("Text"!==t)return[3,8];return[4,n.prompt_long("Item text:")];case 7:case 9:if(!(r=d.sent()))return[2];return[3,17];case 8:if("Module"!==t)return[3,10];return[4,n.prompt("WASM module checksum (this cannot be changed):")];case 10:if("Layout"!==t)return[3,16];return[4,n.confirm("Are you sure you would like to create an item using your current profile layout?\n\nYou can press no to input JSON directly instead.")];case 11:if(d.sent())return[3,13];return[4,n.prompt("Exported layout JSON:")];case 12:if(!(r=d.sent()))return[2];return[2,r];case 15:if(!(y=d.sent()).success)return[2,alert(y.message||"Failed to fetch self.")];return r=JSON.stringify(y.payload.layout),[3,17];case 16:return[2];case 17:return[2,r]}})}),function(t,n){return e.apply(this,arguments)})),a.define("delete",(t=_async_to_generator(function(e,t){var n;return _ts_generator(this,function(r){switch(r.label){case 0:return e.$,n=e.app,[4,trigger("app::confirm",["Are you sure you want to do this?"])];case 1:if(!r.sent())return[2];return fetch("/api/v0/auth/item/".concat(t),{method:"DELETE"}).then(function(e){return e.json()}).then(function(e){n.toast(e.success?"success":"error",e.success?"Item deleted!":e.message)}),[2]}})}),function(e,n){return t.apply(this,arguments)})),a.define("purchase",(n=_async_to_generator(function(e,t,n){var r;return _ts_generator(this,function(s){switch(s.label){case 0:return e.$,r=e.app,[4,trigger("app::confirm",["Are you sure you want to purchase this item for ".concat(n," coins?")])];case 1:if(!s.sent())return[2];return fetch("/api/v0/auth/item/".concat(t,"/buy"),{method:"POST"}).then(function(e){return e.json()}).then(function(e){r.toast(e.success?"success":"error",e.success?"Item purchased!":e.message)}),[2]}})}),function(e,t,r){return n.apply(this,arguments)})),a.define("edit",(r=_async_to_generator(function(e,t,n,r,s){var o;return _ts_generator(this,function(a){return e.$,o=e.app,fetch("/api/v0/auth/item/".concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,description:r,cost:s})}).then(function(e){return e.json()}).then(function(e){o.toast(e.success?"success":"error",e.success?"Item updated!":e.message)}),[2]})}),function(e,t,n,s,o){return r.apply(this,arguments)})),a.define("edit_content",(s=_async_to_generator(function(e,t,n){var r,s,o;return _ts_generator(this,function(a){switch(a.label){case 0:return r=e.$,s=e.app,[4,r.content_input(n)];case 1:return o=a.sent(),fetch("/api/v0/auth/item/".concat(t,"/content"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:o})}).then(function(e){return e.json()}).then(function(e){s.toast(e.success?"success":"error",e.success?"Item updated!":e.message)}),[2]}})}),function(e,t,n){return s.apply(this,arguments)})),a.define("status",(o=_async_to_generator(function(e,t,n){var r;return _ts_generator(this,function(s){return e.$,r=e.app,fetch("/api/v0/auth/item/".concat(t,"/status"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:n})}).then(function(e){return e.json()}).then(function(e){if(r.toast(e.success?"success":"error",e.success?"Item updated!":e.message),e.success){var t=!0,s=!1,o=void 0;try{for(var a,c=Array.from(document.querySelectorAll("[data-item-status]"))[Symbol.iterator]();!(t=(a=c.next()).done);t=!0)a.value.classList.remove("active")}catch(e){s=!0,o=e}finally{try{t||null==c.return||c.return()}finally{if(s)throw o}}document.querySelector('[data-item-status="'.concat(n,'"]')).classList.add("active")}}),[2]})}),function(e,t,n){return o.apply(this,arguments)}))}();