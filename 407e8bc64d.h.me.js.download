'https://github.com/swmff/rainbeam';function asyncGeneratorStep(n,t,e,r,o,a,i){try{var c=n[a](i),u=c.value}catch(n){e(n);return}c.done?t(u):Promise.resolve(u).then(r,o)}function _async_to_generator(n){return function(){var t=this,e=arguments;return new Promise(function(r,o){var a=n.apply(t,e);function i(n){asyncGeneratorStep(a,r,o,i,c,"next",n)}function c(n){asyncGeneratorStep(a,r,o,i,c,"throw",n)}i(void 0)})}}function _ts_generator(n,t){var e,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(e)throw TypeError("Generator is already executing.");for(;i;)try{if(e=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(n,i)}catch(n){a=[6,n],r=0}finally{e=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}!function(){var n,t,e=reg_ns("me");e.LOGIN_ACCOUNT_TOKENS=JSON.parse(window.localStorage.getItem("login_account_tokens")||"{}"),e.define("me",(n=_async_to_generator(function(n){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,fetch("/api/v0/auth/me")];case 1:return[4,n.sent().json()];case 2:return globalThis.__user=n.sent().payload,[2,globalThis.__user]}})}),function(t){return n.apply(this,arguments)})),e.define("logout",(t=_async_to_generator(function(n){var t,e,r;return _ts_generator(this,function(o){switch(o.label){case 0:return t=n.$,[4,trigger("app::confirm",["Are you sure you would like to do this?"])];case 1:if(!o.sent())return[2];return[4,t.me()];case 2:return e=o.sent(),(r=t.LOGIN_ACCOUNT_TOKENS)[e.username]&&(delete r[e.username],t.set_login_account_tokens(r)),fetch("/api/v0/auth/untag",{method:"POST"}).then(function(){fetch("/api/v0/auth/logout",{method:"POST"}).then(function(){var n=Object.keys(r)[0];if(n){t.login(n);return}window.location.href="/"})}),[2]}})}),function(n){return t.apply(this,arguments)})),e.define("set_login_account_tokens",function(n,t){n.$.LOGIN_ACCOUNT_TOKENS=t,window.localStorage.setItem("login_account_tokens",JSON.stringify(t))},["object"]),e.define("login",function(n,t){n.$;var r=e.LOGIN_ACCOUNT_TOKENS[t];r&&(window.location.href="/api/v0/auth/callback?token=".concat(r))}),e.define("ui::render",function(n,t){var e=n.$;t.innerHTML="";var r=!0,o=!1,a=void 0;try{for(var i,c=Object.entries(e.LOGIN_ACCOUNT_TOKENS)[Symbol.iterator]();!(r=(i=c.next()).done);r=!0){var u=i.value;t.innerHTML+="<button class=\"card w-full justify-start\" onclick=\"trigger('me::login', ['".concat(u[0],'\'])">\n                <img\n                    title="').concat(u[0],'\'s avatar"\n                    src="/api/v0/auth/profile/').concat(u[0],'/avatar"\n                    alt=""\n                    class="avatar"\n                    style="--size: 24px"\n                />\n\n                <span>').concat(u[0],"</span>\n            </button>")}}catch(n){o=!0,a=n}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}})}();